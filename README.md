# –û–∫–æ

–û–±—ã—á–Ω—ã–π –±—ã–¥–ª–æ-–∫–æ–¥–∏–Ω–≥, —Ä–∞–∑—Ä–æ—Å—à–∏–π—Å—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 18 –ª–µ—Ç. –í—ã–∫–ª–∞–¥—ã–≤–∞—é —Å—é–¥–∞ - –º–æ–∂–µ—Ç –∫–æ–≥–æ-—Ç–æ —Å–ø–æ–¥–≤–∏–≥–Ω–µ—Ç —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–≤–æ—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ).

## üìã –û–±–∑–æ—Ä

Eye ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è:

- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–ª—è IP-–∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã MikroTik/Linux (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –ª–∏–º–∏—Ç—ã —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ —Å—É—Ç–∫–∏ –∏ –∑–∞ –º–µ—Å—è—Ü).
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ MikroTik; —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è Linux —Ä–∞–Ω–µ–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞, –Ω–æ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞).
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è DHCP-—Å–µ—Ä–≤–µ—Ä–æ–≤  (dnsmasq, MikroTik).
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è DNS-—Å–µ—Ä–≤–µ—Ä–∞ (BIND).
- –û–ø—Ä–æ—Å –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ –ø–æ SNMP —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –∞–Ω–∞–ª–∏–∑–æ–º –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ—Ä—Ç–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è IP-–∞–¥—Ä–µ—Å–æ–≤.
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–≤—ã–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
- –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ Syslog-—Å–æ–æ–±—â–µ–Ω–∏–π.
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

# Eye Monitoring System ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ã:

* ALT Linux 11.1+
* Debian 11+
* Ubuntu 20.04+

---

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x install-eye.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./install-eye.sh

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ)
sudo ./install-eye.sh --auto
````

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ALT Linux, Debian –∏ Ubuntu
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö –°–£–ë–î: MySQL/MariaDB –∏–ª–∏ PostgreSQL (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ, –Ω–µ –¥–ª—è production!)
* –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏–ª–∏ —Ä—É—Å—Å–∫–∏–π
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## üîß –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞


### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—Ä–µ–±—É–µ–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

#### –î–ª—è ALT Linux:

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
apt-get update

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ Eye
apt-get install git xxd wget fping hwdata

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É)
apt-get install mariadb-server mariadb-client    # –î–ª—è MySQL
# –ò–õ–ò
apt-get install postgresql postgresql-client     # –î–ª—è PostgreSQL

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ PHP
apt-get install apache2 php8.2 php8.2-mysqlnd php8.2-pgsql \
php8.2-intl php8.2-mbstring php8.2-fpm-fcgi apache2-mod_fcgid

# Perl-–º–æ–¥—É–ª–∏
apt-get install perl-Net-Patricia perl-NetAddr-IP perl-Config-Tiny \
perl-Net-DNS perl-DateTime perl-Net-Ping \
perl-Net-Netmask perl-Text-Iconv perl-Net-SNMP \
perl-Net-Telnet perl-DBI \
perl-Parallel-ForkManager perl-Proc-Daemon \
perl-DateTime-Format-DateParse perl-DateTime-Format-Strptime \
perl-Net-OpenSSH perl-File-Tail perl-Tie-File \
perl-Crypt-Rijndael perl-Crypt-CBC perl-CryptX perl-Crypt-DES \
perl-File-Path-Tiny perl-Expect perl-Proc-ProcessTable \
perl-Text-CSV \
perl-DBD-Pg perl-DBD-mysql

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
apt-get install dnsmasq syslog-ng syslog-ng-journal pwgen
```

#### –î–ª—è Debian / Ubuntu:

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
apt-get update

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ Eye
apt-get install git xxd bsdmainutils pwgen wget fping ieee-data

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É)
apt-get install mariadb-server mariadb-client    # –î–ª—è MySQL
# –ò–õ–ò
apt-get install postgresql postgresql-client     # –î–ª—è PostgreSQL

# –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ PHP
apt-get install apache2 php php-mysql php-pgsql php-bcmath \
php-intl php-mbstring php-date php-mail php-snmp php-zip \
php-db php-fpm libapache2-mod-fcgid

# Perl-–º–æ–¥—É–ª–∏
apt-get install -y perl \
libnet-patricia-perl libnetaddr-ip-perl libconfig-tiny-perl \
libnet-dns-perl libdatetime-perl libnet-netmask-perl \
libtext-iconv-perl libnet-snmp-perl libnet-telnet-perl \
libdbi-perl libparallel-forkmanager-perl libproc-daemon-perl \
libdatetime-format-dateparse-perl libnetwork-ipv4addr-perl \
libnet-openssh-perl libfile-tail-perl libdatetime-format-strptime-perl \
libcrypt-rijndael-perl libcrypt-cbc-perl libcryptx-perl \
libcrypt-des-perl libfile-path-tiny-perl libexpect-perl \
libtext-csv-perl \
libdbd-pg-perl libdbd-mysql-perl

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
apt-get install dnsmasq syslog-ng
```

---

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≥—Ä—É–ø–ø—ã

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
groupadd --system eye

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
adduser --system --disabled-password --disabled-login \
--ingroup eye --home=/opt/Eye eye

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞
mkdir -p /opt/Eye
chown eye:eye /opt/Eye
chmod 770 /opt/Eye

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å nagios –≤ –≥—Ä—É–ø–ø—É eye
usermod -a -G eye nagios
```

---

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/rajven/Eye

# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤
mkdir -p /opt/Eye/scripts/cfg
mkdir -p /opt/Eye/scripts/log
mkdir -p /opt/Eye/html/cfg
mkdir -p /opt/Eye/html/js
mkdir -p /opt/Eye/docs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
chmod 750 /opt/Eye
chmod 770 /opt/Eye/scripts/log
chmod 750 /opt/Eye/scripts

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
cp -R scripts/ /opt/Eye/
cp -R html/ /opt/Eye/
cp -R docs/ /opt/Eye/

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
chown -R eye:eye /opt/Eye
```

---

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–∞ SNMP SHA512 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ü–∞—Ç—á –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ SNMPv3 SHA512
# –§–∞–π–ª: /opt/Eye/docs/patches/sha512.patch
# –î–ª—è ALT Linux: /opt/Eye/docs/patches/sha512.alt.patch

# –ú–æ–∂–µ—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ç—á –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å –º–æ–¥—É–ª—å
cp /opt/Eye/docs/patches/USM.pm /usr/share/perl5/Net/SNMP/Security/USM.pm
```

---

### –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö JavaScript-–±–∏–±–ª–∏–æ—Ç–µ–∫

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
mkdir -p /opt/Eye/html/js/jq
mkdir -p /opt/Eye/html/js/select2
mkdir -p /opt/Eye/html/js/jstree

# –ó–∞–≥—Ä—É–∑–∫–∞ jQuery
wget https://code.jquery.com/jquery-3.7.0.min.js \
-O /opt/Eye/html/js/jq/jquery.min.js

# –ó–∞–≥—Ä—É–∑–∫–∞ Select2
wget https://github.com/select2/select2/archive/4.0.12.tar.gz -O 4.0.12.tar.gz
tar -xzf 4.0.12.tar.gz -C /opt/Eye/html/js/select2/ \
--strip-components=2 select2-4.0.12/dist
rm -f 4.0.12.tar.gz

# –ó–∞–≥—Ä—É–∑–∫–∞ jsTree
wget https://github.com/vakata/jstree/archive/3.3.12.tar.gz -O jstree.tar.gz
tar -xzf jstree.tar.gz -C /opt/Eye/html/js/
mv /opt/Eye/html/js/jstree-3.3.12/dist/* /opt/Eye/html/js/jstree
rm -rf /opt/Eye/html/js/jstree-3.3.12
rm -f jstree.tar.gz
```

---

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### MySQL / MariaDB:

```bash
systemctl enable mariadb
systemctl start mariadb

mysql_secure_installation

mysql -u root -p < /opt/Eye/docs/databases/mysql/en/create_db.sql
mysql -u root -p stat < /opt/Eye/docs/databases/mysql/en/data.sql

mysql -u root -p <<EOF
CREATE USER 'stat'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON stat.* TO 'stat'@'localhost';
FLUSH PRIVILEGES;
EOF
```

#### PostgreSQL:

```bash
systemctl enable postgresql
systemctl start postgresql

sudo -u postgres psql -f /opt/Eye/docs/databases/postgres/en/create_db.sql
sudo -u postgres psql -d stat -f /opt/Eye/docs/databases/postgres/en/data.sql
sudo -u postgres psql -c "ALTER USER stat WITH PASSWORD 'your_password';"

# –í pg_hba.conf –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
# local   stat            stat                                    md5
```

---

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```bash
cp /opt/Eye/html/cfg/config.sample.php /opt/Eye/html/cfg/config.php
cp /opt/Eye/scripts/cfg/config.sample /opt/Eye/scripts/cfg/config

ENCRYPTION_KEY=$(pwgen 16 1)
ENCRYPTION_IV=$(tr -dc 0-9 </dev/urandom | head -c 16)

chown -R eye:eye /opt/Eye/html/cfg /opt/Eye/scripts/cfg
chmod 660 /opt/Eye/html/cfg/config.php /opt/Eye/scripts/cfg/config
```

---

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Apache –∏ PHP

```bash
cp /opt/Eye/docs/apache/000-default.conf /etc/apache2/sites-available/
a2enmod setenvif proxy proxy_fcgi
cp /opt/Eye/docs/php-fpm/eye.conf /etc/php/8.2/fpm/pool.d/

cp /opt/Eye/docs/sudoers.d/www-data /etc/sudoers.d/eye
sed -i 's/www-data/eye/g' /etc/sudoers.d/eye
chmod 440 /etc/sudoers.d/eye

systemctl restart apache2
systemctl restart php8.2-fpm
```

---

### Cron –∏ Logrotate

```bash
cp /opt/Eye/docs/cron/stat /etc/cron.d/eye
chmod 644 /etc/cron.d/eye

cp /opt/Eye/docs/logrotate/dnsmasq /etc/logrotate.d/dnsmasq-eye
cp /opt/Eye/docs/logrotate/scripts /etc/logrotate.d/eye-scripts
```

---

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### DHCP (dnsmasq):

```bash
cp /etc/dnsmasq.conf /etc/dnsmasq.conf.backup
cat /opt/Eye/docs/addons/dnsmasq.conf > /etc/dnsmasq.conf

cp /opt/Eye/docs/systemd/dhcp-log.service /etc/systemd/system/
cp /opt/Eye/docs/systemd/dhcp-log-truncate.service /etc/systemd/system/

systemctl enable dnsmasq dhcp-log dhcp-log-truncate
systemctl start dnsmasq
```

#### Syslog-ng:

```bash
cp /etc/syslog-ng/syslog-ng.conf /etc/syslog-ng/syslog-ng.conf.backup
mkdir -p /etc/syslog-ng/conf.d
cp /opt/Eye/docs/syslog-ng/eye.conf /etc/syslog-ng/conf.d/

cp /opt/Eye/docs/systemd/syslog-stat.service /etc/systemd/system/

systemctl enable syslog-ng syslog-stat
systemctl restart syslog-ng
systemctl start syslog-stat
```

#### NetFlow:

```bash
cp /opt/Eye/docs/systemd/eye-statd.service /etc/systemd/system/
systemctl enable eye-statd
```

#### Stat-sync:

```bash
cp /opt/Eye/docs/systemd/stat-sync.service /etc/systemd/system/
systemctl enable stat-sync.service
```

---

### –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã MAC-–∞–¥—Ä–µ—Å–æ–≤

```bash
cd /opt/Eye/scripts/utils/mac-oids/
bash download-macs.sh
perl update-mac-vendors.pl
```

---

## üåê –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

* URL: `http://your-server-ip/`
* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `http://your-server-ip/admin/`
* –õ–æ–≥–∏–Ω: `admin`
* –ü–∞—Ä–æ–ª—å: `admin`

---

## üîê –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

* **–ù–ï–ú–ï–î–õ–ï–ù–ù–û —Å–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**
* –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π API-–∫–ª—é—á
* –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø —Å –ø–æ–º–æ—â—å—é firewall
* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
* –î–µ–ª–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

---

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MikroTik

### Firewall:

–ü—Ä–∞–≤–∏–ª–∞ —Å fasttrack –Ω–∞–¥–æ –≤—ã–ª–∫—é—á–∏—Ç—å!!!

```routeros
/ip firewall filter
set disabled=yes [ find action =fasttrack-connection ]
set disabled=yes [ find chain =forward and comment~"established" ]
add action=drop chain=forward comment="deny unknown ips" out-interface-list=WAN src-address-list=!group_all
add action=jump chain=forward comment="users set" in-interface-list=WAN jump-target=Users
add action=jump chain=forward jump-target=Users out-interface-list=WAN
add action=accept chain=forward comment=related,established connection-state=established,related
add action=reject chain=forward comment="deny default wan" in-interface-list=WAN reject-with=icmp-network-unreachable
add action=drop chain=forward out-interface-list=WAN
```


### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–æ–º:

–î–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å—É—é –æ—á–µ—Ä–µ–¥—å —Å –≤–∞—à–∏–º –∫–∞–Ω–∞–ª–æ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –ò–º—è –æ—á—Ä–µ—Ä–µ–¥–∏ –æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ—Ç—Å—è –∏–∑ –∏–º–µ–Ω–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞!

```routeros
/queue tree
add max-limit=100M name=upload_root_ether1 parent=ether1 queue=pcq-upload-default
add name=download_root_bridge parent=bridge queue=pcq-download-default
```

### DHCP-—Å–∫—Ä–∏–ø—Ç (RouterOS 6):

```routeros
/tool fetch mode=http keep-result=no url="http://<EYE_IP>/api.php?login=<LOGIN>&api_key=<API_KEY>&send=dhcp&mac=\$leaseActMAC&ip=\$leaseActIP&action=\$leaseBound&hostname=\$lease-hostname"
```

–° https:
```routeros
/tool fetch mode=https keep-result=no url="https://<EYE_URL>/api.php?login=<LOGIN>&api_key=<API_KEY>&send=dhcp&mac=\$leaseActMAC&ip=\$leaseActIP&action=\$leaseBound&hostname=\$lease-hostname"
```


### DHCP-—Å–∫—Ä–∏–ø—Ç (RouterOS 7):

```routeros
/tool fetch url="http://<EYE_IP>/api.php?login=<LOGIN>&api_key=<API_KEY>&send=dhcp&mac=$leaseActMAC&ip=$leaseActIP&action=$leaseBound&hostname=$"lease-hostname"" mode=http keep-result=no
```

–° https:
```routeros
/tool fetch url="https://<EYE_URL>/api.php?login=<LOGIN>&api_key=<API_KEY>&send=dhcp&mac=$leaseActMAC&ip=$leaseActIP&action=$leaseBound&hostname=$"lease-hostname"" mode=https keep-result=no
```

–ò–º—è dhcp-—Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –æ—Ç –∏–º–µ–Ω–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç. –¢.–µ. –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ bridge => dhcp-bridge

### NetFlow:

```routeros
# RouterOS 6
/ip traffic-flow
set enabled=yes

# RouterOS 7
/ip traffic-flow
set enabled=yes interfaces=WAN

/ip traffic-flow target
add dst-address=<NETFLOW_SERVER_IP> port=2055
```

---
